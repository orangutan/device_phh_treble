#!/system/bin/sh
# we install required apps.
# change system settings for security.
# change app settings.

# we need to detect and run this only when a factory reset is done.
if ! test -d /data/fort
then
	mkdir -p  -m 0775 /data/fort
	chown system:system /data/fort
fi

if ! test -f /data/fort/config
then
	for i in /system/fort/*.apk
	do
		pm install "$i"
	done

	cd /data
	list=$(tar -xvzf /system/fort/sfiles.tar.gz)
	#echo extracted files - $list
	# we need to fix ownership for these
	for i in $(echo $list)
	do
		dir1=$(dirname "$i")
		dir2=$(dirname "$dir1")
		ls -ld $dir2
		owner=$(ls -ld $dir2 | cut -f3 -d' ')
		#echo owner=$owner
		grp=$(ls -ld $dir2 | cut -f4 -d' ')
		#echo grp=$grp
		chown $owner:$grp "$dir2" "$i"
		#ls -l "$i"
	done

	# settings applicable for only factory reset, but not on each boot

	#enable this later when dev is done
	#settings put global adb_enabled 0
	settings put global heads_up_notifications_enabled 0
	# should we set it to 0(default)? or leave it at 2 (never)
	#settings put global wifi_sleep_policy
	settings put global wifi_networks_available_notification_on 0
	settings put global network_recommendations_enabled 0
	settings put global default_restrict_background_data 1
	settings put global power_sounds_enabled 1

	settings put secure install_non_market_apps 0
	#doesnt do much yet, needs more config
	settings put secure always_on_vpn_app com.protonvpn.android
	settings put secure always_on_vpn_lockdown 1
	settings put secure lock_screen_show_notifications 0
	settings put secure mock_location 1

	settings put system notification_light_pulse 0
	#settings put system volume_alarm 10
	#settings put system volume_music 10
	#settings put system volume_voice 10
	#settings put system volume_ring 10
	settings put system show_password 0
	settings put system vibrate_when_ringing 1
	settings put system lockscreen_sounds_enabled 1
	settings put system status_bar_show_battery_percent 1
	settings put system lockscreen_sounds_enabled 1
	
	settings put --lineage system lockscreen_scramble_pin_layout 1
	settings put --lineage system navigation_bar_menu_arrow_keys 1
	settings put --lineage system torch_long_press_power_gesture 1
	settings put --lineage system volbtn_music_controls 1
	settings put --lineage system volume_keys_control_ring_stream 0
	settings put --lineage system enable_people_lookup 0
	settings put --lineage system qs_quick_pulldown 1
	settings put --lineage system volume_wake_screen 1

	echo "fzsetup.reset_done=1" > /data/fort/config 
	chown system:system /data/fort/config
	chmod 0664 /data/fort/config
fi

# these settings are done on every reboot

settings put --lineage stats_collection 0
settings put global bluetooth_on 0
settings put global wifi_display_on 0
settings put global add_users_when_locked 0
#enable this later when dev is done
#settings put global adb_enabled 0
settings put global wifi_wakeup_available 0
settings put global wifi_scan_always_enabled 0
settings put global package_verifier_enable 1
settings put global wifi_wakeup_enabled 0
settings put global assisted_gps_enabled 0
settings put secure lock_screen_allow_private_notifications 0
settings put secure lock_screen_owner_info_enabled 0
settings put secure disabled_print_services com.android.bips/.BuiltInPrintService
settings put --lineage secure privacy_guard_default 1

settings put --lineage secure network_traffic_autohide 1
settings put --lineage secure network_traffic_mode 3
settings put --lineage secure network_traffic_show_units 1
